(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{168:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return c})),r.d(t,"metadata",(function(){return i})),r.d(t,"rightToc",(function(){return b})),r.d(t,"default",(function(){return u}));var a=r(1),n=r(9),o=(r(0),r(193)),c={id:"mbed_mqtt_e",title:"Connect to Azure IoT Hub using WizFi360 MQTT AT Command",sidebar_label:"Mbed MQTT Cmd",keywords:["WizFi360","Mbed"]},i={id:"connect_to_cloud/mbed_mqtt_e",title:"Connect to Azure IoT Hub using WizFi360 MQTT AT Command",description:"## Getting started\r",source:"@site/docs\\connect_to_cloud\\mbed_mqtt_atcmd_e.md",permalink:"/Document/docs/connect_to_cloud/mbed_mqtt_e",editUrl:"https://github.com/wizfi/Document/tree/master/docs/connect_to_cloud/mbed_mqtt_atcmd_e.md",sidebar_label:"Mbed MQTT Cmd",sidebar:"docs",previous:{title:"WizFi360 MQTT AT Command\ub97c \uc774\uc6a9\ud55c Azure IoT Hub \uc5f0\ub3d9 \uc608\uc81c",permalink:"/Document/docs/connect_to_cloud/mbed_mqtt"},next:{title:"NUCLEO-L476RG + WizFi360 Azure AT Command\ub97c \uc774\uc6a9\ud558\uc5ec Azure IoT Hub\uc5d0 \uc5f0\uacb0",permalink:"/Document/docs/connect_to_cloud/mbed_atcmd"}},b=[{value:"Getting started",id:"getting-started",children:[]},{value:"Introduction",id:"introduction",children:[]},{value:"Step 1: Required items",id:"step-1-required-items",children:[{value:"Hadrware",id:"hadrware",children:[]},{value:"Software",id:"software",children:[]}]},{value:"Step 2: Device preparation",id:"step-2-device-preparation",children:[{value:"1. Hardware preparation",id:"1-hardware-preparation",children:[]},{value:"2. Device connection",id:"2-device-connection",children:[]}]},{value:"Step 3: Sample application",id:"step-3-sample-application",children:[{value:"1. Code Download &amp; Execution",id:"1-code-download--execution",children:[]},{value:"2. Parameter update",id:"2-parameter-update",children:[]},{value:"3. Project Build &amp; Run",id:"3-project-build--run",children:[]}]},{value:"Step 4: Results",id:"step-4-results",children:[]},{value:"References",id:"references",children:[]}],l={rightToc:b};function u(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"getting-started"},"Getting started"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Login to ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://portal.azure.com/"}),Object(o.b)("strong",{parentName:"a"},"Azure Portal")),"."),Object(o.b)("p",{parentName:"blockquote"},"\u203b In this guide we will procedd with ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://azure.microsoft.com/ko-kr/free/"}),Object(o.b)("strong",{parentName:"a"},"free account")),".\nTo learn how to create IoT Hub please refer to ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/Wiznet/azure-iot-kr/tree/master/docs/Azure_Cloud"}),"Azure Cloud Service Introduction"),"."),Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.microsoft.com/ko-kr/azure/iot-hub/iot-hub-create-through-portal"}),"[MS] Create IoT Hub using Azure Portal")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/blob/master/docs/Azure_Cloud/create_blob_storage_through_azure_portal.md"}),"Create Blob storage using Azure Portal")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/blob/master/docs/Azure_Cloud/create_stream_analytics_through_azure_portal.md"}),"Create Stream Analytics using Azure Portal")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/blob/master/docs/Azure_Cloud/configure_stream_analytics_job_input_output_and_define_the_transformation_query_through_azure_portal.md"}),"Setup Queries in Stream Analytics using Azure Portal")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/blob/master/docs/IoT_device/Connectivities/Wi-Fi/standalone_mqtt_atcmd_wizfi360.md"}),"Connect to Azure IoT Hub using WizFi360 MQTT AT Command")))),Object(o.b)("h2",{id:"introduction"},"Introduction"),Object(o.b)("p",null,"It is possible to connect to ",Object(o.b)("strong",{parentName:"p"},"Microsoft Azure Service")," using ",Object(o.b)("strong",{parentName:"p"},"WizFi360"),", send data to cloud and monitor current status."),Object(o.b)("p",null,"Data communication will be established as following."),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/mqtt_data_communication_structure.png",alt:null}))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"MQTT AT Commands")," will be used to connect to IoT Hub Service & send data."),Object(o.b)("p",null,"Data sent to IoT Hub will be saved in Blob Storage through Stream Analytics."),Object(o.b)("p",null,"In this guide we will use WizFi360 with ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.mbed.com/en/"}),"Mbed")," to connect to Microsoft Azure Services using MQTT AT Command."),Object(o.b)("h2",{id:"step-1-required-items"},"Step 1: Required items"),Object(o.b)("p",null,"Items below are required for this guide."),Object(o.b)("h3",{id:"hadrware"},"Hadrware"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Desktop or Laptop Computer")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://wizwiki.net/wiki/doku.php/products:wizfi360:start"}),"WizFi360-EVB-Shield"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://os.mbed.com/platforms/ST-Nucleo-L476RG/"}),"NUCLEO-L476RG"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Mini USB Cable"),Object(o.b)("p",{parentName:"li"},Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/mqtt_atcmd_wizfi360_required_item_2.png",alt:null}))))),Object(o.b)("h3",{id:"software"},"Software"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://os.mbed.com/studio/"}),"Mbed Studio")),Object(o.b)("li",{parentName:"ul"},"Preferred Serial Terminal (TeraTerm, Hercules, etc . . .)")),Object(o.b)("h2",{id:"step-2-device-preparation"},"Step 2: Device preparation"),Object(o.b)("h3",{id:"1-hardware-preparation"},"1. Hardware preparation"),Object(o.b)("p",null,"WizFi360-EVB-Shield will be installed on top of NUCLEO-L476RG. Therefore DIP Switch and jumper cables shall be connected as following:"),Object(o.b)("blockquote",null,Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},"SW1 : Off"),Object(o.b)("li",{parentName:"ul"},"SW2 : Off"),Object(o.b)("li",{parentName:"ul"},"SW3 : On"),Object(o.b)("li",{parentName:"ul"},"D2 : UART Tx"),Object(o.b)("li",{parentName:"ul"},"D8 : UART Rx"))),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/set_wizfi360_evb_shield_dip_sw_2.png",alt:null}))),Object(o.b)("h3",{id:"2-device-connection"},"2. Device connection"),Object(o.b)("p",null,"After connecting hardware, connect NUCLEO-L476RG to Desktop or Laptop using USB Cable."),Object(o.b)("p",null,"Check ",Object(o.b)("strong",{parentName:"p"},"COM Port")," from ",Object(o.b)("strong",{parentName:"p"},"Device Manager"),"."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"If COM port cannot be found in Device manager, check link below and follow instructions."),Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.st.com/en/development-tools/stsw-link009.html"}),"ST-LINK, ST-LINK/V2, ST-LINK/V2-1 USB driver")))),Object(o.b)("h2",{id:"step-3-sample-application"},"Step 3: Sample application"),Object(o.b)("h3",{id:"1-code-download--execution"},"1. Code Download & Execution"),Object(o.b)("p",null,"After code download, open project by selecting ",Object(o.b)("strong",{parentName:"p"},"File")," > ",Object(o.b)("strong",{parentName:"p"},"Open Workspace"),"."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Sample code is stored in following path."),Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"samples/Wi-Fi/Mbed_Mqtt_Atcmd_Wizfi360"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"samples/Wi-Fi/Mbed_Mqtt_Atcmd_Wizfi360_Azure_C_Shared_Utility")))),Object(o.b)("p",{parentName:"blockquote"},"In case of ",Object(o.b)("strong",{parentName:"p"},"Mbed_Mqtt_Atcmd_Wizfi360")," SAS Token was created using Device Explorer or Azure IoT Explorer."),Object(o.b)("p",{parentName:"blockquote"},"In case of ",Object(o.b)("strong",{parentName:"p"},"Mbed_Mqtt_Atcmd_Wizfi360_Azure_C_Shared_Utility")," there is no need to create SAS Token separately as azure_c_shared_utility Library was ported into Project.")),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/execute_project_through_mbed_studio_1.png",alt:null}))),Object(o.b)("h3",{id:"2-parameter-update"},"2. Parameter update"),Object(o.b)("p",null,"To connect to Azure IoT Hub, update next parameters."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-cpp"}),'/* Wi-Fi info */\nchar ssid[] = "xxxxxxxxxx";\nchar password[] = "xxxxxxxxxx";\n\n/* MQTT info */\nint alive_time = xx;    // range : 30 ~ 300\n\n/* Azure info */\nchar hub_name[] = "xxxxxxxxxx";\nchar host_name[] = "xxxxxxxxxx";\nchar device_id[] = "xxxxxxxxxx";\nchar device_key[] = "xxxxxxxxxx";\nchar sas_token[] = "xxxxxxxxxx";\n')),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/execute_project_through_mbed_studio_2.png",alt:null}))),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"For ",Object(o.b)("strong",{parentName:"p"},"SAS Token creation")," refer to below."),Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/tree/master/docs/Azure_Cloud/create_sas_token_through_device_explorer.md"}),"Create SAS Token using Device Explorer")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/tree/master/docs/Azure_Cloud/create_sas_token_through_azure_iot_explorer.md"}),"Create SAS Token using Azure IoT Explore")))),Object(o.b)("h3",{id:"3-project-build--run"},"3. Project Build & Run"),Object(o.b)("p",null,"Press ",Object(o.b)("strong",{parentName:"p"},"Run Program")," to Project Build & Run."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Note :"),Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"Start Stream Analytics")," in order to forward data to Blob Storage.")),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/execute_project_through_mbed_studio_3.png",alt:null}))),Object(o.b)("h2",{id:"step-4-results"},"Step 4: Results"),Object(o.b)("p",null,"In terminal program we can check data sent from WizFi360 to Azure IoT Hub. In Blob Storage we can check received data."),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/result_execute_project_through_mbed_studio_1.png",alt:null}))),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"/Document/img/azure_cloud/result_execute_project_through_mbed_studio_2.png",alt:null}))),Object(o.b)("h2",{id:"references"},"References"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/Wiznet/azure-iot-kr/blob/master/docs/IoT_device/Connectivities/Wi-Fi/standalone_mqtt_atcmd_wizfi360.md"}),"Connect to Azure IoT Hub using WizFi360 MQTT AT Command"))))}u.isMDXComponent=!0},193:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return s}));var a=r(0),n=r.n(a);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=n.a.createContext({}),u=function(e){var t=n.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i({},t,{},e)),r},p=function(e){var t=u(e.components);return n.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,l=b(e,["components","mdxType","originalType","parentName"]),p=u(r),d=a,s=p["".concat(c,".").concat(d)]||p[d]||m[d]||o;return r?n.a.createElement(s,i({ref:t},l,{components:r})):n.a.createElement(s,i({ref:t},l))}));function s(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,c=new Array(o);c[0]=d;var i={};for(var b in t)hasOwnProperty.call(t,b)&&(i[b]=t[b]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var l=2;l<o;l++)c[l]=r[l];return n.a.createElement.apply(null,c)}return n.a.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);