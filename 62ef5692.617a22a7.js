(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{158:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return l}));var r=a(1),n=a(9),i=(a(0),a(188)),o={id:"spi_guide",title:"SPI Guide",sidebar_label:"SPI Guide",keywords:["WizFi360","SPI"]},c={id:"basic_guides/spi_guide",title:"SPI Guide",description:"## Introduction\r",source:"@site/docs\\basic_guides\\spi_guide.md",permalink:"/Document/docs/basic_guides/spi_guide",editUrl:"https://github.com/wizfi/Document/tree/master/docs/basic_guides/spi_guide.md",sidebar_label:"SPI Guide",sidebar:"docs",previous:{title:"Firmware Upgrade Guide",permalink:"/Document/docs/basic_guides/firmware_upgrade"},next:{title:"MQTT Client",permalink:"/Document/docs/basic_guides/mqtt_client"}},s=[{value:"Introduction",id:"introduction",children:[]},{value:"Pinout",id:"pinout",children:[]},{value:"SPI Frame Format",id:"spi-frame-format",children:[{value:"SPI Control Frame",id:"spi-control-frame",children:[]},{value:"AT CMD Frame",id:"at-cmd-frame",children:[]},{value:"Data Frame",id:"data-frame",children:[]}]},{value:"Operation",id:"operation",children:[{value:"AT CMD Operation",id:"at-cmd-operation",children:[]},{value:"Data Operation",id:"data-operation",children:[]}]}],p={rightToc:s};function l(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"introduction"},"Introduction"),Object(i.b)("p",null,"WizFi360 operates in SPI slave mode and can be controlled via AT commands. In order to communicate with the MCU, the SPI pins must be connected and set the SPI_EN(PB13) pin to Low for SPI. Refer to Figure 1. WizFi360 Pinout to locate the SPI pins. Set the SPI_INT(PB14) pin to low when the user needs to send data from WizFi360 so that the SPI master can read the data."),Object(i.b)("h2",{id:"pinout"},"Pinout"),Object(i.b)("p",null,"SPI pins are from PB13 to PB17 in the below Figure WizFi360 Pinout."),Object(i.b)("p",null,Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/wizfi360_pinout.png",alt:null}))),Object(i.b)("h2",{id:"spi-frame-format"},"SPI Frame Format"),Object(i.b)("p",null,"WizFi360 is controlled by the SPI frame format sent from the SPI master. The SPI frame is controlled by CSn and composed of SPI Control Frame, AT CMD Frame, and DATA Frame . DATA Frame composed RX DATA Frame and TX DATA Frame. Users can select the default status, buffer save size, CMD, DATA SEND, and DATA RECEIVE during the control phase."),Object(i.b)("h3",{id:"spi-control-frame"},"SPI Control Frame"),Object(i.b)("p",null,"TX BUFF AVAIL, RX DATA LEN, and INT STATUS must be read before users write or read data into WizFi360.\nThe SPI Control Frame sends 1Byte of control byte and reads 2Byte of status data."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"0x03(TX BUFF AVAIL) : checks whether the peer buffer is ready to write date before transmission."),Object(i.b)("li",{parentName:"ul"},"0x02(RX DATA LEN) : reads the data length accumulated in the peer buffer before the data is received."),Object(i.b)("li",{parentName:"ul"},"0x06(INT STATUS) : reads the interrupt status of slave.")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"SPI Control Frame"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig2_spi_control_frame.png",alt:null}))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"SPI Timing Graph (SPI Control Frame)"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig3_spi_timing_graph.png",alt:null}))),Object(i.b)("h3",{id:"at-cmd-frame"},"AT CMD Frame"),Object(i.b)("p",null,"The AT CMD frame reads the TX BUFF AVAIL from the ",Object(i.b)("strong",{parentName:"p"},"SPI Control Frame")," and sets the Control Byte as 0x91 during the Control Phase if 0x0002 or bit 2 is high. Then the CMD length is set in units of 4bytes and AT CMD messages are included in the data for transmission. AT CMD reply uses the ",Object(i.b)("strong",{parentName:"p"},"RX Data Frame")," method when receiving data. Please refer to the AT instruction set for more details on AT-CMD."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"AT CMD Frame"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig4_at_cmd_frame.png",alt:null}))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"SPI Timing Graph (AT CMD Frame)"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig5_spi_timing_graph.png",alt:null}))),Object(i.b)("h3",{id:"data-frame"},"Data Frame"),Object(i.b)("h4",{id:"tx-data-frame"},"TX Data Frame"),Object(i.b)("p",null,"AT+CIPSEND, AT+CIPSENDEX, and AT+CIPSENDBUF must be transmitted from the ",Object(i.b)("strong",{parentName:"p"},"AT CMD Frame")," and users must follow the next steps to prepare TCP or UDP data transmission in DATA trans mode.\nThe TX data frame reads the TX BUFF AVAIL from the ",Object(i.b)("strong",{parentName:"p"},"SPI Control Frame")," and sets the Control Byte as 0x90 during the Control Phase if 0x0002 or bit 2 is high. Then the CMD length is set in units of 4bytes and DATA messages are included in the data for transmission. DATA reply uses the ",Object(i.b)("strong",{parentName:"p"},"RX Data Frame")," method when receiving data. "),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"TX Data Frame"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig6_tx_data_frame.png",alt:null}))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"SPI Timing Graph (TX DATA Frame)"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig7.png",alt:null}))),Object(i.b)("h4",{id:"rx-data-frame"},"RX Data Frame"),Object(i.b)("p",null,"When a reply or data is received after the ",Object(i.b)("strong",{parentName:"p"},"AT CMD Frame")," is transmitted, check whether the interrupt pin is low or not. If the interrupt pin is low, users read the value of INT STATUS using the SPI Control Frame. If the value of INT STATUS is 0x0002 or bit 2 is high, users read the value of RX DATA LEN using the ",Object(i.b)("strong",{parentName:"p"},"SPI Control Frame"),". And if the value of RX Data Len is not zero, users set the Control Byte as 0x10 during the control phase and read data. The total data count is the value of RX DATA LEN."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"RX Data Frame"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig8.png",alt:null}))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"SPI Timing Graph (RX Data Frame)"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig9.png",alt:null}))),Object(i.b)("h2",{id:"operation"},"Operation"),Object(i.b)("h3",{id:"at-cmd-operation"},"AT CMD Operation"),Object(i.b)("p",null,"Use AT CMD to set WizFi360 or follow the steps below to set SEND mode and request data."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"AT CMD Operation Flowchart"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig10.png",alt:null}))),Object(i.b)("h3",{id:"data-operation"},"Data Operation"),Object(i.b)("p",null,"Data can be sent if AT+CIPSEND, AT+CIPSENDEX, OR AT+CIPSENDBUF is entered in AT CMD or in DATA TRANS mode."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"DATA Operation Flowchart"),"\n",Object(i.b)("img",Object(r.a)({parentName:"p"},{src:"/Document/img/basic_guides/spi_guide/fig11.png",alt:null}))))}l.isMDXComponent=!0},188:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d}));var r=a(0),n=a.n(r);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=n.a.createContext({}),l=function(e){var t=n.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):c({},t,{},e)),a},u=function(e){var t=l(e.components);return n.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},b=Object(r.forwardRef)((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(a),b=r,d=u["".concat(o,".").concat(b)]||u[b]||m[b]||i;return a?n.a.createElement(d,c({ref:t},p,{components:a})):n.a.createElement(d,c({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=b;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var p=2;p<i;p++)o[p]=a[p];return n.a.createElement.apply(null,o)}return n.a.createElement.apply(null,a)}b.displayName="MDXCreateElement"}}]);